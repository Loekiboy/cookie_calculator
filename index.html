<!DOCTYPE html>
<html>
<head>
	<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Patrick+Hand&display=swap" rel="stylesheet">
    <link rel="icon" type="images/webp" href="images/fav.webp">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/poly-decomp.js/0.3.0/poly-decomp.min.js"></script>
	<title>Cookie Calculator</title>
	<style>
		body {
			font-family: 'Patrick Hand', cursive; 
			background-color: #ffce91;
			text-align: center;
			padding: 20px;
			font-size: 1.2rem;
		}

		#list {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 15px;
			padding: 0;
			max-width: 800px;
			margin: 20px auto;
		}

		li {
			list-style: none;
			background: white;
			padding: 20px;
			border-radius: 15px;
			box-shadow: 0 4px 8px rgba(0,0,0,0.1);
			border: 2px solid #ffe0b2;
			transition: transform 0.1s;
		}

		#list li {
			font-weight: bold;
			font-size: 1.3rem;
			color: #5d4037;
		}

		.slider-container {
			margin: 30px 0;
			width: 100%;
			max-width: 400px;
			display: inline-block;
		}

		#slider {
			-webkit-appearance: none;
			width: 100%;
			height: 15px;
			background: #e0e0e0;
			outline: none;
			border-radius: 10px;
		}

		#slider::-webkit-slider-thumb {
			-webkit-appearance: none;
			width: 30px;
			height: 30px;
			border-radius: 50%;
			background: #d84315;
			cursor: pointer;
			border: 3px solid #fff;
		}

		@keyframes bump {
			0% { transform: scale(1); }
			50% { transform: scale(1.025) rotate(var(--random-deg, 1deg)); }
			100% { transform: scale(1); }
		}

		.bump-effect { animation: bump 0.1s ease-out; }

		#cookieCount {
			display: inline-block;
			transition: transform 0.1s ease-out;
		}

		.count-bump {
			transform: scale(1.3) !important;
			color: #d84315;
		}

		#cookie-bin {
			width: 100%;
			max-width: 500px;
			height: 300px;
			background: rgba(255, 255, 255, 0.3);
			border-radius: 20px;
			margin: 20px auto;
			position: relative;
			border: 3px dashed #d84315;
			overflow: hidden;
		}

        /* instructions */
        #instructions-container {
            max-width: 800px;
            margin: 30px auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: left;
            border: 2px solid #ffe0b2;
        }

        #instructions-container h2 {
            color: #d84315;
            margin-top: 0;
            text-align: center;
        }

        #method p {
            line-height: 1.6;
            margin-bottom: 15px;
            color: #5d4037;
        }
	</style>
</head>
<body>

	<h1>Cookie Calculator</h1>

	<div id="cookie-bin"></div>

	<p>Number of cookies: <span id="cookieCount">20</span></p>

	<div class="slider-container">
		<input type="range" id="slider" min="1" max="80" value="20">
	</div>

    <h2 style="color: #d84315; margin-top: 40px;">Ingredients</h2>
	<ul id="list"></ul>

    <div id="instructions-container">
        <h2>Instructions</h2>
        <div id="method"></div>
    </div>

    <div class="credits">
        Original recipe: <a href="https://sallysbakingaddiction.com/chewy-chocolate-chip-cookies/#tasty-recipes-70437" target="_blank">Sally's Baking Addiction</a>
    </div>

	<script>
		const slider = document.getElementById('slider');
		const tekst = document.getElementById('cookieCount');
		const lijst = document.getElementById('list');
		const bin = document.getElementById('cookie-bin');
		const base = 20;

		const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

		const { Engine, Render, Runner, Bodies, World, Vertices, Body } = Matter;

        let lastValue = 20;

		const engine = Engine.create();
		const render = Render.create({
			element: bin,
			engine: engine,
			options: {
				width: 500,
				height: 300,
				wireframes: false,
				background: 'transparent'
			}
		});

		const ground = Bodies.rectangle(250, 310, 600, 60, { isStatic: true });
		const leftWall = Bodies.rectangle(-10, 150, 20, 300, { isStatic: true });
		const rightWall = Bodies.rectangle(510, 150, 20, 300, { isStatic: true });
		World.add(engine.world, [ground, leftWall, rightWall]);

		Render.run(render);
		Runner.run(Runner.create(), engine);

		let cookieBodies = [];

		function playPop(aantal) {
            const isMovingUp = aantal > lastValue;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.frequency.setValueAtTime(400 + (aantal * 5), audioCtx.currentTime);
    
            if (isMovingUp) {
                oscillator.type = 'sine';
                oscillator.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.1);
            } else {
                oscillator.type = 'square';
                oscillator.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.05);
            }

            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
    
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
    
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);

            lastValue = aantal;
}

		function spawnCrumb(x, y) {
			const spreadX = (Math.random() - 0.5) * 30;
			const spreadY = (Math.random() - 0.5) * 30;

			const crumb = Bodies.polygon(x + spreadX, y + spreadY, 5, Math.random() * 4 + 2, {
				restitution: 0.6,
				friction: 0.1,
				render: {
					fillStyle: '#ac5922'
				}
			});
			
			Body.setVelocity(crumb, { x: spreadX / 5, y: -2 });

			World.add(engine.world, crumb);

			setTimeout(() => {
				let opacity = 1;
				const fadeInterval = setInterval(() => {
					opacity -= 0.05; 
					if (opacity <= 0) {
						clearInterval(fadeInterval);
						World.remove(engine.world, crumb);
					} else {
						crumb.render.opacity = opacity;
					}
				}, 50);
			}, 3000);
		}

		function spawnCookie() {
			const x = Math.random() * 400 + 50;
			const shape = [{ x: 0, y: 20 }, { x: 50, y: 0 }, { x: 100, y: 20 }, { x: 50, y: 25 }];
			
			const cookie = Bodies.fromVertices(x, -50, [shape], {
				restitution: 0.2,
				friction: 0.5,
				render: {
					sprite: { texture: 'images/cookie.png', xScale: 0.25, yScale: 0.25 }
				}
			});

			if (cookie) {
				cookieBodies.push(cookie);
				World.add(engine.world, cookie);
			}
		}

		function removeCookie() {
			const cookie = cookieBodies.pop();
			if (cookie) {
				const posX = cookie.position.x;
				const posY = cookie.position.y;
				
				World.remove(engine.world, cookie);

				const aantalKruimels = Math.floor(Math.random() * 3) + 1;
				

				for(let i = 0; i < aantalKruimels; i++) {
					spawnCrumb(posX, posY);
				}
			}
		}

		function updateCookiePhysics() {
			const gewenst = parseInt(slider.value);
			const huidig = cookieBodies.length;
			if (gewenst > huidig) {
				for (let i = 0; i < (gewenst - huidig); i++) spawnCookie();
			} else if (gewenst < huidig) {
				for (let i = 0; i < (huidig - gewenst); i++) removeCookie();
			}
		}

		function bereken() {
			const aantal = slider.value;
			tekst.innerText = aantal;
			const factor = aantal / base;
			const ingredients = {
				flour: Math.round(281 * factor),
				butter: Math.round(170 * factor),
				brownSugar: Math.round(150 * factor),
				whiteSugar: Math.round(100 * factor),
				chips: Math.round(225 * factor),
				vanilla: (2 * factor).toFixed(1),
				soda: (1 * factor).toFixed(1),
				salt: (0.5 * factor).toFixed(1)
			};


			let eggText = (factor <= 1) ? "1 egg + 1 egg yolk" : Math.ceil(1 * factor) + " eggs" + " + " + Math.ceil(1 * factor) + " egg yolks";

			lijst.innerHTML = `
				<li>üåæ ${ingredients.flour}g Flour</li>
				<li>üßà ${ingredients.butter}g Butter</li>
				<li>üü§ ${ingredients.brownSugar}g Brown sugar</li>
				<li>‚ö™ ${ingredients.whiteSugar}g White sugar</li>
				<li>ü•ö ${eggText}</li>
				<li>üç¶ ${ingredients.vanilla} tsp Vanilla</li>
				<li>üßÇ ${ingredients.soda} tsp Soda</li>
				<li>üßÇ ${ingredients.salt} tsp Salt</li>
				<li>üç´ ${ingredients.chips}g Chips</li>
			`;

             const methodDiv = document.getElementById('method');

            const recipeSteps = [
                "In a large bowl, whisk the flour, baking soda, cornstarch, and salt together. Set aside.",
                `In a medium bowl, whisk the melted butter, brown sugar, and granulated sugar together. <strong>Whisk in ${(1 * factor).toFixed(1)} egg(s) and ${(1 * factor).toFixed(1)} egg yolk(s)</strong> until combined, then whisk in the vanilla extract.`,
                "Pour into dry ingredients and mix together with a large spoon or spatula. The dough will be very soft, thick, and shiny. Fold in the chocolate chips.",
                "Cover the dough tightly and refrigerate for at least 2 hours or up to 3 days. I highly recommend chilling the cookie dough overnight to prevent overspreading.",
                "Preheat oven to 325¬∞F (163¬∞C). Line large baking sheets with parchment paper or silicone baking mats.",
                "Scoop the chilled dough (about 50-60g per cookie). Roll into a ball, then shape it so it's taller rather than wide‚Äîalmost like a cylinder. This helps the cookies bake up thicker. Arrange 3 inches apart.",
                "Bake for 13‚Äì14 minutes. The edges should be lightly browned, but the centers will look soft. Cool on the sheet for 10 minutes before moving to a rack."
            ];

            methodDiv.innerHTML = recipeSteps.map(step => `<p>‚Ä¢ ${step}</p>`).join('');
		}

		slider.oninput = function() {
			bereken();
			updateCookiePhysics();
			playPop(this.value);
			if (navigator.vibrate) navigator.vibrate(10);
			tekst.classList.remove('count-bump');
			void tekst.offsetWidth; 
			tekst.classList.add('count-bump');
			const cards = document.querySelectorAll('#list li');
			cards.forEach(card => {
				card.style.setProperty('--random-deg', (Math.random() * 4 - 2) + 'deg');
				card.classList.remove('bump-effect');
				void card.offsetWidth;
				card.classList.add('bump-effect');
			});
		};

		bereken();
		updateCookiePhysics();
	</script>
</body>
</html>